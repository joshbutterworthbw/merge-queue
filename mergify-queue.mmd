flowchart TB
    Start([Monitor PRs]) --> Cond{Conditions met?}
    Cond -->|No| Start
    Cond -->|Yes| AddQueue[Add PR to queue]
    
    AddQueue --> HasItems{Items in queue?}
    HasItems -->|No| HasItems
    HasItems -->|Yes| TakeFirst[Take first PR in queue]
    
    TakeFirst --> ConflictCheck{Conflicts with another PR in queue?}
    ConflictCheck -->|Yes| DequeueLower[Dequeue lower PR in queue]
    DequeueLower --> MsgConflict[Add message explaining conflict]
    MsgConflict --> HasItems
    
    ConflictCheck -->|No| CreateDraft[Create draft PR: branch + latest main/master]
    CreateDraft --> WaitTests[Wait for all tests to finish]
    WaitTests --> TestResult{Tests pass?}
    
    TestResult -->|Yes| Merge[Merge the original PR]
    Merge --> CloseDraft[Close the draft PR]
    CloseDraft --> HasItems
    
    TestResult -->|No| Dequeue[Dequeue the PR]
    Dequeue --> AddLabel[Add dequeued label]
    AddLabel --> AddComment[Add comment to original PR]
    AddComment --> TakeFirst
    
    Dequeue -.->|Later| Changes{Changes detected on PR?}
    Changes -->|Auto| AddQueue
    Changes -->|Manual| ManualReadd[User manually re-adds to queue]
    ManualReadd --> AddQueue
